# 队列通知功能 (PRIS-84) 手工测试用例

## 📋 功能概述

**功能名称**: 浏览器队列通知系统  
**Jira Ticket**: PRIS-84  
**提交记录**: 
- `a7588c2` - 添加浏览器队列通知
- `faecce5` - 重置通知标志并优化移动端体验
- `72c5a34` - 合并 PR #12

**功能描述**:  
当用户在机器人控制队列中等待时，系统会在用户位置接近轮次时通过浏览器通知提醒用户，避免错过控制机会。

---

## 🎯 测试策略分析

### 核心功能点

#### 1. **通知权限管理** 🔐
- 桌面端：加入队列后显示权限请求提示框
- 移动端：不显示权限请求提示框（因浏览器支持不一致）
- 权限提示框可以被关闭
- 点击"Enable"按钮触发浏览器原生权限请求

#### 2. **通知触发时机** ⏰
- **位置 #6**: 发送第一次通知 "You're at position 6 in the queue!"
- **位置 #2**: 发送第二次通知 "You're at position 2 in the queue!"
- 通知仅在权限已授予时发送

#### 3. **状态管理** 🔄
- 使用 `hasSentFirstNotificationRef` 和 `hasSentSecondNotificationRef` 防止重复发送
- 用户离开队列时重置通知标志
- 用户激活控制时重置通知标志
- Fast Track 不会导致重复通知

#### 4. **通知内容** 💬
- 标题：位置提醒
- 内容：引导用户返回应用
- 图标：PrismaX logo (favicon.svg)
- 自动关闭时间：12秒

---

## 🧪 测试环境要求

### 测试账号
- **Amplifier Member**: 用于标准测试
- **Innovator Member**: 用于 Fast Track 测试
- **Explorer Member**: 用于升级提示测试

### 测试机器人
- `arm1` - 主要测试机器人
- `arm2` - Partner ARM（需要邀请码）
- `arm3` - 可选测试机器人

### 测试浏览器
- ✅ **Chrome 120+** (桌面 + 移动)
- ✅ **Firefox 120+** (桌面)
- ✅ **Safari 17+** (桌面 + iOS)
- ✅ **Edge 120+** (桌面)

### 测试设备
- **桌面**: Windows 10/11, macOS Ventura+, Ubuntu 22.04+
- **移动**: iOS 17+, Android 13+

### 测试环境 URL
- **开发环境**: http://localhost:3000
- **QA 环境**: https://qa.prismax.ai
- **Staging 环境**: https://staging.prismax.ai

---

## 📝 测试用例

---

### **测试模块 A: 通知权限请求 - 桌面端**

---

#### **用例 QN-M-001: 桌面端首次加入队列显示权限提示框**

**优先级**: P0 🔴  
**测试类型**: 功能测试  
**预计时间**: 3 分钟

**前置条件**:
1. 使用桌面浏览器（Chrome/Firefox/Safari/Edge）
2. 浏览器视口宽度 > 1000px
3. 浏览器通知权限为 "default"（未设置）
4. 已登录测试账号（Amplifier Member）
5. 在 TeleOp 页面选择机器人（如 arm1）

**测试步骤**:
1. 在队列面板点击 "Enter Live Control" 按钮
2. 等待加入队列成功（显示 "You are now #X in the queue" 提示）
3. 观察队列面板顶部区域

**预期结果**:
- ✅ 队列面板顶部显示浅灰色通知权限提示框
- ✅ 提示框包含文本: "🔔 Enable notifications to get alerts on your position in the queue."
- ✅ 提示框包含绿色 "Enable" 按钮
- ✅ 提示框右上角有关闭按钮（X 图标）
- ✅ 提示框样式美观，符合 PrismaX 设计规范

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-002: 点击 Enable 按钮触发权限请求**

**优先级**: P0 🔴  
**测试类型**: 功能测试  
**预计时间**: 3 分钟

**前置条件**:
1. 完成 QN-M-001，权限提示框已显示
2. 浏览器通知权限为 "default"

**测试步骤**:
1. 点击权限提示框中的绿色 "Enable" 按钮
2. 观察浏览器原生权限请求弹窗
3. 在浏览器原生弹窗中点击 "Allow" / "允许"
4. 观察页面反馈

**预期结果**:
- ✅ 浏览器显示原生通知权限请求弹窗
- ✅ 弹窗询问是否允许 prismax.ai 发送通知
- ✅ 点击允许后，权限提示框自动消失
- ✅ 页面显示绿色成功提示: "Notifications enabled! We'll send you two alerts before you're at position 5 and then 1..."
- ✅ 成功提示持续显示约 10 秒后自动消失

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-003: 点击关闭按钮隐藏权限提示框**

**优先级**: P1 🟠  
**测试类型**: 功能测试  
**预计时间**: 2 分钟

**前置条件**:
1. 完成 QN-M-001，权限提示框已显示
2. 未点击 Enable 按钮

**测试步骤**:
1. 点击权限提示框右上角的 X 关闭按钮
2. 观察权限提示框状态

**预期结果**:
- ✅ 权限提示框立即消失
- ✅ 不触发浏览器原生权限请求
- ✅ 不显示任何错误提示
- ✅ 队列功能正常运行

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-004: 拒绝通知权限后提示框消失**

**优先级**: P1 🟠  
**测试类型**: 功能测试  
**预计时间**: 3 分钟

**前置条件**:
1. 完成 QN-M-001，权限提示框已显示
2. 浏览器通知权限为 "default"

**测试步骤**:
1. 点击权限提示框中的绿色 "Enable" 按钮
2. 在浏览器原生权限请求弹窗中点击 "Block" / "阻止"
3. 观察页面状态

**预期结果**:
- ✅ 权限提示框立即消失
- ✅ 不显示任何错误提示
- ✅ 队列功能正常运行
- ✅ 不会收到浏览器通知（后续测试中验证）

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-005: 权限已授予时不显示提示框**

**优先级**: P0 🔴  
**测试类型**: 功能测试  
**预计时间**: 3 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已设置为 "granted"（已允许）
3. 已登录测试账号

**测试步骤**:
1. 在 TeleOp 页面选择机器人
2. 点击 "Enter Live Control" 按钮加入队列
3. 观察队列面板顶部

**预期结果**:
- ✅ 不显示通知权限提示框
- ✅ 直接显示队列状态
- ✅ 系统准备在合适位置发送通知

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-006: 权限已拒绝时不显示提示框**

**优先级**: P1 🟠  
**测试类型**: 功能测试  
**预计时间**: 3 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已设置为 "denied"（已阻止）
3. 已登录测试账号

**测试步骤**:
1. 在 TeleOp 页面选择机器人
2. 点击 "Enter Live Control" 按钮加入队列
3. 观察队列面板顶部

**预期结果**:
- ✅ 不显示通知权限提示框
- ✅ 直接显示队列状态
- ✅ 队列功能正常运行（不影响核心功能）

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 B: 通知权限请求 - 移动端**

---

#### **用例 QN-M-007: 移动端加入队列不显示权限提示框**

**优先级**: P0 🔴  
**测试类型**: 功能测试  
**预计时间**: 3 分钟

**前置条件**:
1. 使用移动设备浏览器（iOS Safari / Chrome, Android Chrome）
2. 或桌面浏览器模拟移动视口（宽度 < 1000px）
3. 浏览器通知权限为 "default"
4. 已登录测试账号

**测试步骤**:
1. 在 TeleOp 页面选择机器人
2. 点击 "Enter Live Control" 按钮加入队列
3. 观察队列面板顶部和整个页面

**预期结果**:
- ✅ 不显示通知权限提示框
- ✅ 直接显示队列状态和位置信息
- ✅ 不触发任何权限请求
- ✅ 队列功能正常运行

**理由**: 移动端浏览器对通知 API 支持不一致，避免混淆用户

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 C: 通知触发 - 位置 #6**

---

#### **用例 QN-M-008: 队列位置到达 #6 时发送第一次通知**

**优先级**: P0 🔴  
**测试类型**: 功能测试  
**预计时间**: 10-15 分钟（需等待队列）

**前置条件**:
1. 使用桌面浏览器（Chrome 推荐）
2. 浏览器通知权限已设置为 "granted"
3. 已登录测试账号
4. 队列中有足够用户（至少 6 人）

**测试步骤**:
1. 在 TeleOp 页面选择机器人并加入队列
2. 记录当前队列位置（如位置 #10）
3. 等待队列向前移动到位置 #6
4. 观察浏览器通知

**预期结果**:
- ✅ 当位置到达 #6 时，立即收到浏览器通知
- ✅ 通知标题: "You're at position 6 in the queue!"
- ✅ 通知内容: "It's almost your turn! Please continue to monitor the queue status."
- ✅ 通知显示 PrismaX 图标（favicon.svg）
- ✅ 通知持续显示约 12 秒后自动关闭
- ✅ 点击通知会聚焦到 PrismaX 标签页

**测试技巧**:
- 如果队列人数不足，可以使用多个测试账号快速填充队列
- 或者等待用户自然离开队列使位置前移

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-009: 位置 #6 通知内容准确性验证**

**优先级**: P1 🟠  
**测试类型**: 功能测试  
**预计时间**: 参考 QN-M-008

**前置条件**:
1. 同 QN-M-008
2. 准备截图工具

**测试步骤**:
1. 执行 QN-M-008 的步骤
2. 当收到位置 #6 的通知时，立即截图
3. 仔细检查通知的每个细节

**预期结果**:
- ✅ 通知标题准确显示: "You're at position 6 in the queue!"
- ✅ 通知正文准确显示: "It's almost your turn! Please continue to monitor the queue status."
- ✅ 通知图标为 PrismaX logo（不是默认浏览器图标）
- ✅ 通知徽章（badge）也为 PrismaX logo
- ✅ 文字清晰可读，无拼写错误
- ✅ 通知格式符合操作系统风格（Windows/macOS）

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 D: 通知触发 - 位置 #2**

---

#### **用例 QN-M-010: 队列位置到达 #2 时发送第二次通知**

**优先级**: P0 🔴  
**测试类型**: 功能测试  
**预计时间**: 15-20 分钟（需等待队列）

**前置条件**:
1. 使用桌面浏览器（Chrome 推荐）
2. 浏览器通知权限已设置为 "granted"
3. 已登录测试账号
4. 已收到位置 #6 的通知（QN-M-008 已通过）

**测试步骤**:
1. 继续等待队列向前移动
2. 当位置从 #3 移动到 #2 时
3. 观察浏览器通知

**预期结果**:
- ✅ 当位置到达 #2 时，立即收到浏览器通知
- ✅ 通知标题: "You're at position 2 in the queue!"
- ✅ 通知内容: "You're up next! There is one user ahead of you. Please return to the app."
- ✅ 通知显示 PrismaX 图标
- ✅ 通知持续显示约 12 秒后自动关闭
- ✅ 此通知与位置 #6 的通知是独立的（不同的提醒）

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-011: 位置 #2 通知内容准确性验证**

**优先级**: P1 🟠  
**测试类型**: 功能测试  
**预计时间**: 参考 QN-M-010

**前置条件**:
1. 同 QN-M-010
2. 准备截图工具

**测试步骤**:
1. 执行 QN-M-010 的步骤
2. 当收到位置 #2 的通知时，立即截图
3. 仔细检查通知的每个细节

**预期结果**:
- ✅ 通知标题准确显示: "You're at position 2 in the queue!"
- ✅ 通知正文准确显示: "You're up next! There is one user ahead of you. Please return to the app."
- ✅ 通知图标为 PrismaX logo
- ✅ 通知徽章为 PrismaX logo
- ✅ 文字清晰可读，无拼写错误
- ✅ 语气紧急，提醒用户即将轮到

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-012: 位置 #1 激活时不发送通知**

**优先级**: P1 🟠  
**测试类型**: 功能测试  
**预计时间**: 5 分钟（在 QN-M-010 基础上）

**前置条件**:
1. 已完成 QN-M-010，当前位置为 #2
2. 等待前一个用户完成控制

**测试步骤**:
1. 等待位置从 #2 移动到 #1
2. 观察是否收到新的浏览器通知
3. 观察页面状态变化

**预期结果**:
- ✅ 位置到达 #1 且状态变为 "active" 时，不发送浏览器通知
- ✅ 页面显示绿色应用内提示: "It's your turn! You now have 5 minutes to control the robot."
- ✅ 自动切换到控制面板
- ✅ 倒计时开始（5 分钟）

**理由**: 用户已经轮到，应该在页面内，不需要额外通知

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 E: 防止重复通知**

---

#### **用例 QN-M-013: 同一位置不重复发送通知**

**优先级**: P0 🔴  
**测试类型**: 状态管理测试  
**预计时间**: 10 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 已登录测试账号
4. 队列中有足够用户

**测试步骤**:
1. 加入队列并等待位置到达 #6
2. 收到第一次通知后，记录通知数量（应为 1）
3. 保持在位置 #6 约 30 秒（不要前移）
4. 观察是否收到重复通知
5. 继续等待位置移动到 #2
6. 收到第二次通知后，同样保持位置观察

**预期结果**:
- ✅ 位置 #6 只收到 1 次通知，不会重复发送
- ✅ 位置 #2 只收到 1 次通知，不会重复发送
- ✅ 总共只收到 2 次通知（位置 #6 一次，位置 #2 一次）

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-014: Fast Track 后不重复发送通知**

**优先级**: P1 🟠  
**测试类型**: 状态管理测试  
**预计时间**: 10 分钟

**前置条件**:
1. 使用桌面浏览器
2. 使用 Amplifier Member 账号（支持 Fast Track）
3. 浏览器通知权限已授予
4. 队列中有足够用户（至少 6 人）

**测试步骤**:
1. 加入队列，位置为 #10 或更后
2. 等待位置到达 #6，收到第一次通知
3. 立即点击 "Fast Track" 按钮
4. 完成 Fast Track 付费流程（如果需要）
5. 观察位置跳转（如从 #6 跳到 #2 或 #1）
6. 观察是否收到新的通知

**预期结果**:
- ✅ 位置 #6 收到一次通知
- ✅ Fast Track 后位置跳转，但不重复发送位置 #6 的通知
- ✅ 如果跳到位置 #2，收到位置 #2 的通知（如果之前未发送过）
- ✅ 如果跳到位置 #1，不收到通知（因为已激活）
- ✅ 通知标志正确管理，不会因为 Fast Track 触发重复通知

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 F: 状态重置**

---

#### **用例 QN-M-015: 离开队列后重置通知标志**

**优先级**: P0 🔴  
**测试类型**: 状态管理测试  
**预计时间**: 15 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 已登录测试账号

**测试步骤**:
1. 加入队列，等待位置到达 #6
2. 收到位置 #6 的通知
3. 继续等待到位置 #4 或 #3
4. 点击 "Leave Queue" 按钮离开队列
5. 观察页面显示 "You have left the queue" 提示
6. 立即重新点击 "Enter Live Control" 加入队列
7. 如果再次排到位置 #6，观察是否收到通知

**预期结果**:
- ✅ 第一次在位置 #6 收到通知
- ✅ 离开队列成功
- ✅ 重新加入队列后，如果再次到达位置 #6，能再次收到通知
- ✅ 通知标志已正确重置

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-016: 激活控制后重置通知标志**

**优先级**: P0 🔴  
**测试类型**: 状态管理测试  
**预计时间**: 20 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 已登录测试账号

**测试步骤**:
1. 加入队列，等待位置到达 #6
2. 收到位置 #6 的通知
3. 继续等待到位置 #2，收到第二次通知
4. 继续等待到位置 #1 并激活控制
5. 观察控制界面启动
6. 控制 5 分钟或手动结束控制
7. 控制结束后，立即重新加入队列
8. 等待再次到达位置 #6 和 #2，观察通知

**预期结果**:
- ✅ 第一轮队列：位置 #6 收到通知，位置 #2 收到通知
- ✅ 激活控制成功
- ✅ 控制结束后重新加入队列
- ✅ 第二轮队列：位置 #6 能再次收到通知，位置 #2 能再次收到通知
- ✅ 通知标志在激活控制后已正确重置

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 G: 边界条件**

---

#### **用例 QN-M-017: 跳过位置 #6（从 #7 直接到 #5）**

**优先级**: P1 🟠  
**测试类型**: 边界条件测试  
**预计时间**: 15 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 已登录测试账号

**测试步骤**:
1. 加入队列，位置为 #7
2. 等待队列更新
3. 观察位置变化（可能由于多人同时离开，从 #7 跳到 #5）
4. 观察是否收到位置 #6 的通知

**预期结果**:
- ✅ 如果位置跳过 #6（从 #7 直接到 #5），不会收到位置 #6 的通知
- ✅ 系统不会为未经历的位置发送通知
- ✅ 队列功能正常运行

**注意**: 此场景需要队列中多人同时离开，可能需要协调测试

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-018: 跳过位置 #2（从 #3 直接到 #1）**

**优先级**: P1 🟠  
**测试类型**: 边界条件测试  
**预计时间**: 15 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 已登录测试账号
4. 已收到位置 #6 的通知

**测试步骤**:
1. 等待位置到达 #3
2. 等待队列更新（可能由于位置 #2 用户离开，直接跳到 #1）
3. 观察是否收到位置 #2 的通知

**预期结果**:
- ✅ 如果位置跳过 #2（从 #3 直接到 #1），不会收到位置 #2 的通知
- ✅ 直接激活控制（位置 #1）
- ✅ 系统不会为未经历的位置发送通知

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-019: 浏览器不支持通知 API**

**优先级**: P1 🟠  
**测试类型**: 兼容性测试  
**预计时间**: 5 分钟

**前置条件**:
1. 使用不支持通知 API 的浏览器（如非常老旧的浏览器）
2. 或使用开发者工具禁用通知 API：
   ```javascript
   delete window.Notification;
   ```
3. 已登录测试账号

**测试步骤**:
1. 在 TeleOp 页面选择机器人
2. 点击 "Enter Live Control" 加入队列
3. 观察页面是否显示错误

**预期结果**:
- ✅ 不显示通知权限提示框
- ✅ 队列功能正常运行（核心功能不受影响）
- ✅ 不显示任何错误提示
- ✅ 用户可以正常排队和控制机器人

**理由**: 通知功能是增强功能，不应影响核心队列功能

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-020: 快速连续加入/离开队列**

**优先级**: P2 🟡  
**测试类型**: 压力测试  
**预计时间**: 5 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 已登录测试账号

**测试步骤**:
1. 快速点击 "Enter Live Control" 加入队列
2. 立即点击 "Leave Queue" 离开队列
3. 重复步骤 1-2，连续 5 次
4. 观察页面状态和浏览器控制台

**预期结果**:
- ✅ 每次加入/离开操作都成功
- ✅ 不显示任何错误提示
- ✅ 浏览器控制台无 JavaScript 错误
- ✅ 通知权限提示框显示/隐藏正常
- ✅ 状态管理正确，无内存泄漏

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 H: 跨浏览器兼容性**

---

#### **用例 QN-M-021: Chrome 浏览器完整流程**

**优先级**: P0 🔴  
**测试类型**: 兼容性测试  
**预计时间**: 20 分钟

**前置条件**:
1. Chrome 浏览器 120+ (Windows/macOS/Linux)
2. 已登录测试账号
3. 浏览器通知权限为 "default"

**测试步骤**:
1. 执行完整流程：
   - 加入队列
   - 显示权限提示框
   - 授予通知权限
   - 等待位置 #6，收到通知
   - 等待位置 #2，收到通知
   - 离开队列
   - 重新加入队列并验证通知重置

**预期结果**:
- ✅ 所有功能在 Chrome 上正常工作
- ✅ 通知显示美观，符合 Chrome 通知风格
- ✅ 性能流畅，无卡顿
- ✅ 无控制台错误

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-022: Firefox 浏览器完整流程**

**优先级**: P1 🟠  
**测试类型**: 兼容性测试  
**预计时间**: 20 分钟

**前置条件**:
1. Firefox 浏览器 120+ (Windows/macOS/Linux)
2. 已登录测试账号
3. 浏览器通知权限为 "default"

**测试步骤**:
1. 执行与 QN-M-021 相同的完整流程

**预期结果**:
- ✅ 所有功能在 Firefox 上正常工作
- ✅ 通知显示美观，符合 Firefox 通知风格
- ✅ 权限请求流程符合 Firefox 标准
- ✅ 无控制台错误

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-023: Safari 浏览器完整流程**

**优先级**: P1 🟠  
**测试类型**: 兼容性测试  
**预计时间**: 20 分钟

**前置条件**:
1. Safari 浏览器 17+ (macOS)
2. 已登录测试账号
3. 浏览器通知权限为 "default"

**测试步骤**:
1. 执行与 QN-M-021 相同的完整流程
2. 特别注意 Safari 的通知权限管理

**预期结果**:
- ✅ 所有功能在 Safari 上正常工作
- ✅ 通知显示美观，符合 macOS 通知中心风格
- ✅ Safari 特殊的权限请求流程正常工作
- ✅ 无控制台错误

**注意**: Safari 对通知 API 支持较晚，需特别验证

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-024: iOS Safari 移动端验证**

**优先级**: P1 🟠  
**测试类型**: 兼容性测试  
**预计时间**: 10 分钟

**前置条件**:
1. iOS 17+ 设备，使用 Safari 浏览器
2. 已登录测试账号

**测试步骤**:
1. 在 iOS Safari 中打开 PrismaX TeleOp 页面
2. 加入队列
3. 观察是否显示权限提示框

**预期结果**:
- ✅ 不显示通知权限提示框（移动端）
- ✅ 队列功能正常运行
- ✅ UI 适配移动端
- ✅ 无功能异常

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-025: Android Chrome 移动端验证**

**优先级**: P1 🟠  
**测试类型**: 兼容性测试  
**预计时间**: 10 分钟

**前置条件**:
1. Android 13+ 设备，使用 Chrome 浏览器
2. 已登录测试账号

**测试步骤**:
1. 在 Android Chrome 中打开 PrismaX TeleOp 页面
2. 加入队列
3. 观察是否显示权限提示框

**预期结果**:
- ✅ 不显示通知权限提示框（移动端）
- ✅ 队列功能正常运行
- ✅ UI 适配移动端
- ✅ 无功能异常

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 I: 用户体验与性能**

---

#### **用例 QN-M-026: 通知响应时间验证**

**优先级**: P2 🟡  
**测试类型**: 性能测试  
**预计时间**: 15 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 打开浏览器开发者工具（Network 和 Performance 标签）

**测试步骤**:
1. 加入队列并等待位置到达 #6
2. 记录队列位置更新的时间戳（通过 Socket.IO 事件）
3. 记录浏览器通知显示的时间戳
4. 计算延迟时间

**预期结果**:
- ✅ 从队列位置更新到通知显示的延迟 < 500ms
- ✅ 用户感觉通知是即时的
- ✅ 无明显卡顿或延迟

**实际结果**:  
延迟时间: _________ ms

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-027: 权限提示框 UI 验证**

**优先级**: P2 🟡  
**测试类型**: UI/UX 测试  
**预计时间**: 5 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限为 "default"
3. 使用标准视口：1280x720

**测试步骤**:
1. 加入队列，显示权限提示框
2. 仔细检查提示框的视觉效果
3. 对比 PrismaX 设计规范

**预期结果**:
- ✅ 提示框背景色: #1a2332 (深色)
- ✅ 边框色: #2a3647
- ✅ 圆角: 12px
- ✅ Enable 按钮颜色: #38CB89 (绿色)
- ✅ 鼠标悬停 Enable 按钮时颜色变为 #059669
- ✅ 关闭按钮 (X) 在右上角，灰色，悬停时变白色
- ✅ 文字清晰可读，间距合理
- ✅ 整体美观，符合 PrismaX 品牌风格

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-028: 通知点击行为验证**

**优先级**: P2 🟡  
**测试类型**: 功能测试  
**预计时间**: 10 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. PrismaX 标签页在后台

**测试步骤**:
1. 加入队列
2. 切换到其他标签页或最小化浏览器
3. 等待位置到达 #6，收到通知
4. 点击浏览器通知

**预期结果**:
- ✅ 点击通知后，浏览器窗口被聚焦
- ✅ PrismaX 标签页被激活并显示在前台
- ✅ 用户可以立即看到队列状态
- ✅ 提升用户回到应用的便利性

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

#### **用例 QN-M-029: 通知自动关闭时间验证**

**优先级**: P2 🟡  
**测试类型**: 功能测试  
**预计时间**: 15 分钟

**前置条件**:
1. 使用桌面浏览器
2. 浏览器通知权限已授予
3. 准备计时器

**测试步骤**:
1. 加入队列并等待位置到达 #6
2. 收到通知后立即开始计时
3. 不要点击或关闭通知
4. 等待通知自动消失
5. 记录通知显示的时长

**预期结果**:
- ✅ 通知自动在约 12 秒后关闭
- ✅ 允许误差范围：±1 秒（即 11-13 秒）
- ✅ 通知不会一直停留

**实际结果**:  
实际显示时长: _________ 秒

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

### **测试模块 J: 回归测试**

---

#### **用例 QN-M-030: 核心队列功能不受影响**

**优先级**: P0 🔴  
**测试类型**: 回归测试  
**预计时间**: 15 分钟

**前置条件**:
1. 使用桌面浏览器
2. 已登录测试账号

**测试步骤**:
1. 测试完整的队列流程（无论通知权限状态）：
   - 加入队列
   - 查看队列列表（显示所有排队用户）
   - 查看自己的位置和倒计时
   - 等待轮到自己（位置 #1，状态 active）
   - 激活控制
   - 控制机器人 5 分钟
   - 控制结束
   - 离开队列

**预期结果**:
- ✅ 所有核心队列功能正常工作
- ✅ 通知功能是增强功能，不影响核心逻辑
- ✅ 无论通知权限状态如何，队列都能正常运行
- ✅ 用户可以正常控制机器人

**实际结果**:  
_[测试时填写]_

**测试状态**: ⬜ Pass / ⬜ Fail / ⬜ Blocked  
**缺陷 ID**: _[如有]_  
**测试日期**: ___________  
**测试人员**: ___________

---

## 📊 测试执行记录表

### 测试汇总

| 测试模块 | 用例数 | P0 用例 | P1 用例 | P2 用例 | 通过 | 失败 | 阻塞 |
|---------|--------|---------|---------|---------|------|------|------|
| A. 通知权限请求 - 桌面端 | 6 | 3 | 3 | 0 | | | |
| B. 通知权限请求 - 移动端 | 1 | 1 | 0 | 0 | | | |
| C. 通知触发 - 位置 #6 | 2 | 1 | 1 | 0 | | | |
| D. 通知触发 - 位置 #2 | 3 | 1 | 2 | 0 | | | |
| E. 防止重复通知 | 2 | 1 | 1 | 0 | | | |
| F. 状态重置 | 2 | 2 | 0 | 0 | | | |
| G. 边界条件 | 4 | 0 | 3 | 1 | | | |
| H. 跨浏览器兼容性 | 5 | 1 | 4 | 0 | | | |
| I. 用户体验与性能 | 4 | 0 | 0 | 4 | | | |
| J. 回归测试 | 1 | 1 | 0 | 0 | | | |
| **总计** | **30** | **11** | **14** | **5** | | | |

### 优先级说明
- **P0 (Blocker)** 🔴: 核心功能，必须通过才能发布
- **P1 (Critical)** 🟠: 重要功能，强烈建议修复
- **P2 (Major)** 🟡: 增强功能，可以后续优化

---

## 🐛 缺陷报告模板

**缺陷标题**: [PRIS-84] [模块名称] 简短描述

**优先级**: P0 / P1 / P2  
**严重程度**: Blocker / Critical / Major / Minor  
**测试用例 ID**: QN-M-XXX

**环境信息**:
- 浏览器: Chrome 120.0.6099.109
- 操作系统: Windows 11 / macOS 14.2
- 测试环境: QA / Staging
- 账号类型: Amplifier Member
- 机器人: arm1

**复现步骤**:
1. 
2. 
3. 

**预期结果**:

**实际结果**:

**截图/视频**:
[附件]

**控制台错误**:
```
[粘贴错误日志]
```

**补充信息**:

---

## 📈 测试完成标准

### 发布准入标准
- ✅ 所有 P0 用例 100% 通过
- ✅ P1 用例通过率 ≥ 95%
- ✅ P2 用例通过率 ≥ 90%
- ✅ 无 P0/P1 级别的未修复缺陷
- ✅ Chrome 浏览器 100% 兼容
- ✅ 核心队列功能不受影响（回归测试通过）

### 建议发布前检查清单
- [ ] 所有测试用例已执行
- [ ] 测试报告已生成
- [ ] 所有 Critical 缺陷已修复并验证
- [ ] 跨浏览器测试已完成
- [ ] 性能指标符合预期
- [ ] 产品经理已审核测试结果
- [ ] 开发团队已确认代码质量

---

## 🔧 测试技巧与注意事项

### 权限管理技巧
1. **重置浏览器通知权限**:
   - Chrome: 设置 → 隐私和安全 → 网站设置 → 通知 → 找到 prismax.ai → 删除
   - Firefox: 设置 → 隐私与安全 → 权限 → 通知 → 设置 → 移除网站
   - Safari: 偏好设置 → 网站 → 通知 → 移除 prismax.ai

2. **快速测试不同权限状态**:
   - 使用浏览器隐身模式（每次都是 default 状态）
   - 使用多个浏览器配置文件

### 队列测试技巧
1. **快速到达测试位置**:
   - 使用多个测试账号同时加入队列
   - 协调其他测试人员快速离开队列
   - 在测试环境中，可以请开发调整队列参数

2. **监控 Socket.IO 事件**:
   - 打开浏览器控制台
   - 观察 `queue_update` 事件
   - 验证位置变化的准确性

3. **验证通知**:
   - 使用屏幕录制工具记录整个测试过程
   - 截图保存每个通知内容
   - 使用计时器精确测量时间

### 常见问题排查
1. **通知没有显示**:
   - 检查浏览器权限状态
   - 检查系统通知设置（Windows/macOS）
   - 检查浏览器控制台是否有错误
   - 确认队列位置确实到达触发点

2. **权限提示框没有显示**:
   - 确认是桌面端（宽度 > 1000px）
   - 确认权限状态为 "default"
   - 检查浏览器控制台错误

3. **重复收到通知**:
   - 这是一个缺陷，需要报告
   - 记录详细的复现步骤
   - 检查是否 Fast Track 或重新加入队列

---

## 📚 参考资料

- **代码文件**:
  - `src/components/TeleOp/TeleOpQueueBody.js` (行 230-234, 263-264)
  - `src/components/TeleOp/TeleOpRightPanel.js` (行 182-194, 227-228, 464-479)
  - `src/components/TeleOp/QueuePanel.module.css` (行 389-446)

- **相关文档**:
  - [Notification API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API)
  - [Browser Notification Permissions](https://developer.mozilla.org/en-US/docs/Web/API/Notification/permission)
  - PRIS-84 Jira Ticket

- **Git 提交**:
  - `a7588c2` - 添加浏览器队列通知
  - `faecce5` - 重置通知标志并优化移动端体验
  - `72c5a34` - 合并 PR #12

---

## ✅ 审核记录

| 日期 | 审核人 | 角色 | 状态 | 备注 |
|------|--------|------|------|------|
| 2026-01-21 | ___________ | QA Lead | ⬜ 待审核 | |
| | ___________ | 开发负责人 | ⬜ 待审核 | |
| | ___________ | 产品经理 | ⬜ 待审核 | |

---

**文档版本**: v1.0  
**创建日期**: 2026-01-21  
**最后更新**: 2026-01-21  
**文档所有者**: QA Team  
**下次审核日期**: 2026-02-21

---

## 📝 测试执行签名

**测试执行人**: ___________________  
**执行日期**: ___________________  
**测试环境**: ___________________  
**测试结果**: PASS / FAIL / PARTIAL  

**备注**:  
_________________________________________________________________  
_________________________________________________________________  
_________________________________________________________________
