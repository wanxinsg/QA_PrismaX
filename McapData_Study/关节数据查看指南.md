# MCAP å…³èŠ‚æ•°æ®æŸ¥çœ‹æŒ‡å—

## ğŸ“š å·¥å…·æ¦‚è§ˆ

åœ¨ `McapData/` ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬æä¾›äº†å¤šä¸ªå·¥å…·æ¥æŸ¥çœ‹å’Œåˆ†æ MCAP æ•°æ®ï¼š

| å·¥å…· | ç”¨é€” | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `quick_view.py` | å¿«é€ŸæŸ¥çœ‹æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯ | äº†è§£æ–‡ä»¶æ¦‚å†µã€é€šé“æ•°é‡ã€æ—¶é•¿ç­‰ |
| `parse_mcap.py` | å®Œæ•´åˆ†æå’Œæ¯”è¾ƒ | è¯¦ç»†åˆ†æå¤šä¸ªæ–‡ä»¶ã€ç”ŸæˆæŠ¥å‘Š |
| `view_joint_data.py` | æŸ¥çœ‹å…·ä½“å…³èŠ‚æ•°æ® | æŸ¥çœ‹å…³èŠ‚ä½ç½®ã€é€Ÿåº¦ã€åŠ›çŸ©ç­‰è¯¦ç»†ä¿¡æ¯ |
| `interactive_viewer.py` | äº¤äº’å¼æŸ¥çœ‹å™¨ | ä¾¿æ·åœ°æµè§ˆä¸åŒé€šé“çš„æ•°æ® |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æŸ¥çœ‹æ–‡ä»¶æ¦‚å†µ

```bash
cd /Users/wanxin/PycharmProjects/Prismax/QA_PrismaX/McapData

# å¿«é€ŸæŸ¥çœ‹ 0.mcap æ–‡ä»¶ä¿¡æ¯
python3 quick_view.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap
```

**è¾“å‡ºå†…å®¹**ï¼š
- æ–‡ä»¶å¤§å°
- æ¶ˆæ¯æ€»æ•°ã€é€šé“æ•°é‡
- è®°å½•æ—¶é•¿
- æ¯ä¸ªé€šé“çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ¶ˆæ¯æ•°ã€å¸§ç‡ã€æ•°æ®é‡ï¼‰

### 2. æŸ¥çœ‹å…·ä½“å…³èŠ‚æ•°æ®

```bash
# æŸ¥çœ‹å·¦è‡‚ä¸»æ§åˆ¶å™¨æ•°æ®ï¼ˆå‰10æ¡ï¼‰
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_lead/joint_states

# æŸ¥çœ‹æ›´å¤šæ¶ˆæ¯ï¼ˆå‰50æ¡ï¼‰
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_lead/joint_states --max 50

# åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„é€šé“
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap --list
```

### 3. ä½¿ç”¨äº¤äº’å¼æŸ¥çœ‹å™¨

```bash
python3 interactive_viewer.py
```

ç„¶åæŒ‰ç…§èœå•æç¤ºï¼š
1. é€‰æ‹© MCAP æ–‡ä»¶
2. é€‰æ‹©è¦æŸ¥çœ‹çš„é€šé“
3. è¾“å…¥æ˜¾ç¤ºçš„æ¶ˆæ¯æ•°é‡

---

## ğŸ“Š å…³èŠ‚æ•°æ®è§£æç»“æœ

### å¯ç”¨çš„å…³èŠ‚çŠ¶æ€é€šé“

æ‰€æœ‰ MCAP æ–‡ä»¶éƒ½åŒ…å«ä»¥ä¸‹ 4 ä¸ªå…³èŠ‚çŠ¶æ€é€šé“ï¼š

| é€šé“åç§° | è¯´æ˜ | ç”¨é€” |
|---------|------|------|
| `/robot/arm_left_lead/joint_states` | å·¦è‡‚ä¸»æ§åˆ¶å™¨ | å·¦è‡‚çš„å‘½ä»¤ä½ç½® |
| `/robot/arm_left_follow/joint_states` | å·¦è‡‚ä»æ§åˆ¶å™¨ | å·¦è‡‚çš„å®é™…åé¦ˆ |
| `/robot/arm_right_lead/joint_states` | å³è‡‚ä¸»æ§åˆ¶å™¨ | å³è‡‚çš„å‘½ä»¤ä½ç½® |
| `/robot/arm_right_follow/joint_states` | å³è‡‚ä»æ§åˆ¶å™¨ | å³è‡‚çš„å®é™…åé¦ˆ |

### å…³èŠ‚ç»„æˆ

æ¯ä¸ªæ‰‹è‡‚æœ‰ **7 ä¸ªå…³èŠ‚**ï¼š

| åºå· | å…³èŠ‚åç§° | ä¸­æ–‡åç§° | å…¸å‹èŒƒå›´ | è¯´æ˜ |
|------|---------|---------|---------|------|
| [0] | `shoulder_pan` | è‚©éƒ¨æ—‹è½¬ | Â±180Â° | æ‰‹è‡‚æ°´å¹³æ—‹è½¬ |
| [1] | `shoulder_lift` | è‚©éƒ¨æŠ¬å‡ | Â±90Â° | æ‰‹è‡‚ä¸Šä¸‹è¿åŠ¨ |
| [2] | `elbow_flex` | è‚˜éƒ¨å¼¯æ›² | 0~150Â° | è‚˜å…³èŠ‚å¼¯æ›² |
| [3] | `wrist_flex` | è…•éƒ¨å¼¯æ›² | Â±90Â° | æ‰‹è…•ä¸Šä¸‹å¼¯æ›² |
| [4] | `wrist_roll` | è…•éƒ¨æ—‹è½¬ | Â±180Â° | æ‰‹è…•æ—‹è½¬ |
| [5] | `gripper` | å¤¹çˆªå¼€åˆ | 0~90Â° | å¤¹çˆªå¼ å¼€/é—­åˆ |
| [6] | `gripper_finger` | å¤¹çˆªæ‰‹æŒ‡ | 0~45Â° | å¤¹çˆªæ‰‹æŒ‡ä½ç½® |

### æ•°æ®å†…å®¹

æ¯æ¡å…³èŠ‚çŠ¶æ€æ¶ˆæ¯åŒ…å«ï¼š

```
ğŸ“Š å…³èŠ‚çŠ¶æ€:
   å…³èŠ‚åç§°: shoulder_pan, shoulder_lift, elbow_flex, ...
   
   ğŸ”µ ä½ç½® (Position): å•ä½ radï¼ˆå¼§åº¦ï¼‰å’Œ Â°ï¼ˆè§’åº¦ï¼‰
      [0] shoulder_pan:  -0.286222 rad (-16.40Â°)
      [1] shoulder_lift: -0.024130 rad (-1.38Â°)
      ...
   
   ğŸŸ¢ é€Ÿåº¦ (Velocity): å•ä½ rad/sï¼ˆå¼§åº¦/ç§’ï¼‰
      [0] shoulder_pan:   0.000000 rad/s
      ...
   
   ğŸ”´ åŠ›çŸ© (Effort): å•ä½ Nmï¼ˆç‰›é¡¿Â·ç±³ï¼‰
      [0] shoulder_pan:   0.000000 Nm
      ...
```

---

## ğŸ” å®é™…æ•°æ®ç¤ºä¾‹

### å·¦è‡‚ä¸»æ§åˆ¶å™¨ï¼ˆLeadï¼‰

```
æ¶ˆæ¯ #1
  æ—¶é—´æˆ³:     1769668975752605311 ns
  ç›¸å¯¹æ—¶é—´:   0.000 ç§’

  å…³èŠ‚ä½ç½®:
    shoulder_pan:   -0.286 rad (-16.40Â°)  â† æ‰‹è‡‚å‘å·¦æ—‹è½¬çº¦16åº¦
    shoulder_lift:  -0.024 rad (-1.38Â°)   â† æ‰‹è‡‚ç•¥å¾®å‘ä¸‹
    elbow_flex:      0.029 rad (1.67Â°)    â† è‚˜éƒ¨å‡ ä¹ä¼¸ç›´
    wrist_flex:     -0.066 rad (-3.78Â°)   â† æ‰‹è…•ç•¥å¾®å‘ä¸‹
    wrist_roll:      0.072 rad (4.10Â°)    â† æ‰‹è…•è½»å¾®æ—‹è½¬
    gripper:         0.032 rad (1.84Â°)    â† å¤¹çˆªæ¥è¿‘é—­åˆ
    gripper_finger:  0.025 rad (1.44Â°)    â† æ‰‹æŒ‡ä½ç½®
```

### å³è‡‚ä¸»æ§åˆ¶å™¨ï¼ˆLeadï¼‰

```
æ¶ˆæ¯ #1
  æ—¶é—´æˆ³:     1769668975752605311 ns
  ç›¸å¯¹æ—¶é—´:   0.000 ç§’

  å…³èŠ‚ä½ç½®:
    shoulder_pan:    0.226 rad (12.97Â°)   â† æ‰‹è‡‚å‘å³æ—‹è½¬çº¦13åº¦
    shoulder_lift:   0.006 rad (0.36Â°)    â† æ‰‹è‡‚æ¥è¿‘æ°´å¹³
    elbow_flex:      0.023 rad (1.34Â°)    â† è‚˜éƒ¨å‡ ä¹ä¼¸ç›´
    wrist_flex:     -0.861 rad (-49.35Â°)  â† æ‰‹è…•å‘ä¸‹å¼¯æ›²çº¦50åº¦
    wrist_roll:      0.010 rad (0.58Â°)    â† æ‰‹è…•åŸºæœ¬æ— æ—‹è½¬
    gripper:         0.865 rad (49.54Â°)   â† å¤¹çˆªåŠå¼€çŠ¶æ€
    gripper_finger:  0.001 rad (0.04Â°)    â† æ‰‹æŒ‡ä½ç½®
```

### æ•°æ®ç‰¹ç‚¹

1. **é‡‡æ ·é¢‘ç‡**: çº¦ 48 Hzï¼ˆæ¯ç§’ 48 æ¬¡é‡‡æ ·ï¼‰
2. **æ—¶é—´ç²¾åº¦**: çº³ç§’çº§ï¼ˆ10^-9 ç§’ï¼‰
3. **ä½ç½®ç²¾åº¦**: å°æ•°ç‚¹å 6 ä½ï¼ˆå¾®å¼§åº¦çº§åˆ«ï¼‰
4. **æ•°æ®åŒ…å¤§å°**: 220 bytes/æ¶ˆæ¯

---

## ğŸ’¡ å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæŸ¥çœ‹æœºå™¨äººåˆå§‹å§¿æ€

```bash
# æŸ¥çœ‹ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œäº†è§£æœºå™¨äººåˆå§‹ä½ç½®
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_lead/joint_states --max 1
```

### åœºæ™¯ 2ï¼šåˆ†æå…³èŠ‚è¿åŠ¨è½¨è¿¹

```bash
# æŸ¥çœ‹å¤šæ¡æ¶ˆæ¯ï¼Œè§‚å¯Ÿå…³èŠ‚å¦‚ä½•å˜åŒ–
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_lead/joint_states --max 100
```

### åœºæ™¯ 3ï¼šå¯¹æ¯”å·¦å³è‡‚çŠ¶æ€

```bash
# å…ˆæŸ¥çœ‹å·¦è‡‚
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_lead/joint_states --max 5

# å†æŸ¥çœ‹å³è‡‚
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_right_lead/joint_states --max 5
```

### åœºæ™¯ 4ï¼šéªŒè¯ Lead å’Œ Follow çš„å·®å¼‚

```bash
# æŸ¥çœ‹ä¸»æ§åˆ¶å™¨
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_lead/joint_states --max 5

# æŸ¥çœ‹ä»æ§åˆ¶å™¨ï¼ˆå®é™…åé¦ˆï¼‰
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_follow/joint_states --max 5

# å¯¹æ¯”ä¸¤è€…å·®å¼‚ï¼ˆå»¶è¿Ÿã€è·Ÿè¸ªè¯¯å·®ç­‰ï¼‰
```

### åœºæ™¯ 5ï¼šæ¯”è¾ƒä¸åŒæ•°æ®é›†

```bash
# æŸ¥çœ‹ 0.mcap
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/0.mcap \
  --topic /robot/arm_left_lead/joint_states --max 5

# æŸ¥çœ‹ 50.mcap
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/50.mcap \
  --topic /robot/arm_left_lead/joint_states --max 5

# æŸ¥çœ‹ 100.mcap
python3 view_joint_data.py ../Feature_CaseDesign/4_Mcap\ Data/output-20260129/100.mcap \
  --topic /robot/arm_left_lead/joint_states --max 5
```

---

## ğŸ“ˆ æ•°æ®åˆ†æå»ºè®®

### 1. è¿åŠ¨å¹³æ»‘æ€§æ£€æŸ¥

æŸ¥çœ‹è¿ç»­æ¶ˆæ¯çš„ä½ç½®å˜åŒ–ï¼Œåˆ¤æ–­è¿åŠ¨æ˜¯å¦å¹³æ»‘ï¼š
- ä½ç½®å˜åŒ–åº”è¯¥è¿ç»­ï¼Œæ— çªè·³
- é€Ÿåº¦åº”è¯¥åˆç†ï¼Œæ— å¼‚å¸¸å³°å€¼

### 2. æ§åˆ¶å»¶è¿Ÿåˆ†æ

å¯¹æ¯” Leadï¼ˆå‘½ä»¤ï¼‰å’Œ Followï¼ˆåé¦ˆï¼‰ï¼š
- ç†æƒ³æƒ…å†µä¸‹åº”è¯¥åŸºæœ¬ä¸€è‡´
- å¦‚æœå·®å¼‚è¾ƒå¤§ï¼Œè¯´æ˜å¯èƒ½å­˜åœ¨æ§åˆ¶å»¶è¿Ÿæˆ–è·Ÿè¸ªè¯¯å·®

### 3. å…³èŠ‚èŒƒå›´éªŒè¯

æ£€æŸ¥å…³èŠ‚ä½ç½®æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…ï¼š
- shoulder_pan: Â±180Â°
- shoulder_lift: Â±90Â°
- elbow_flex: 0~150Â°
- wrist_flex: Â±90Â°
- wrist_roll: Â±180Â°
- gripper: 0~90Â°

### 4. é‡‡æ ·ç‡ç¨³å®šæ€§

æŸ¥çœ‹ç›¸é‚»æ¶ˆæ¯çš„æ—¶é—´é—´éš”ï¼š
- ç†æƒ³é—´éš”: ~20msï¼ˆ50Hzï¼‰
- å®é™…: ~21msï¼ˆ48Hzï¼‰
- æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸çš„é•¿æ—¶é—´é—´éš”

---

## ğŸ› ï¸ è¿›é˜¶ä½¿ç”¨

### å¯¼å‡ºæ•°æ®åˆ° CSV

å¯ä»¥ä¿®æ”¹è„šæœ¬ï¼Œå°†å…³èŠ‚æ•°æ®å¯¼å‡ºä¸º CSV æ ¼å¼ï¼Œä¾¿äºåœ¨ Excel æˆ– Python ä¸­è¿›ä¸€æ­¥åˆ†æï¼š

```python
import csv

# åœ¨ view_joint_data.py ä¸­æ·»åŠ å¯¼å‡ºåŠŸèƒ½
with open('joint_data.csv', 'w', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['timestamp', 'joint_0', 'joint_1', '...'])
    # å†™å…¥æ•°æ®...
```

### ç»˜åˆ¶å…³èŠ‚è½¨è¿¹å›¾

ä½¿ç”¨ matplotlib ç»˜åˆ¶å…³èŠ‚ä½ç½®éšæ—¶é—´çš„å˜åŒ–ï¼š

```python
import matplotlib.pyplot as plt

timestamps = []
positions = {f'joint_{i}': [] for i in range(7)}

# è¯»å–æ•°æ®...
# å¡«å…… timestamps å’Œ positions

# ç»˜å›¾
for i in range(7):
    plt.plot(timestamps, positions[f'joint_{i}'], label=f'Joint {i}')

plt.xlabel('Time (s)')
plt.ylabel('Position (rad)')
plt.legend()
plt.show()
```

### è®¡ç®—è¿åŠ¨ç»Ÿè®¡

```python
import numpy as np

positions = [...]  # ä» MCAP è¯»å–çš„ä½ç½®æ•°æ®

# è®¡ç®—ç»Ÿè®¡é‡
mean_pos = np.mean(positions)
std_pos = np.std(positions)
max_pos = np.max(positions)
min_pos = np.min(positions)
range_pos = max_pos - min_pos

print(f"å¹³å‡ä½ç½®: {mean_pos:.3f} rad")
print(f"æ ‡å‡†å·®: {std_pos:.3f} rad")
print(f"è¿åŠ¨èŒƒå›´: {range_pos:.3f} rad")
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°é€Ÿåº¦å’ŒåŠ›çŸ©æ•°æ®ï¼Ÿ

**A**: Leadï¼ˆä¸»æ§åˆ¶å™¨ï¼‰é€šé“é€šå¸¸åªåŒ…å«ä½ç½®å‘½ä»¤ã€‚é€Ÿåº¦å’ŒåŠ›çŸ©æ•°æ®å¯èƒ½åœ¨ Followï¼ˆä»æ§åˆ¶å™¨ï¼‰é€šé“ä¸­ï¼Œå› ä¸ºé‚£æ˜¯å®é™…çš„åé¦ˆæ•°æ®ã€‚

### Q2: å¦‚ä½•æŸ¥çœ‹æŸä¸ªå…·ä½“æ—¶é—´ç‚¹çš„æ•°æ®ï¼Ÿ

**A**: å¯ä»¥ä½¿ç”¨ `--max` å‚æ•°æŸ¥çœ‹æ›´å¤šæ¶ˆæ¯ï¼Œç„¶åæ ¹æ®ç›¸å¯¹æ—¶é—´æŸ¥æ‰¾ã€‚æˆ–è€…ä¿®æ”¹è„šæœ¬æ·»åŠ æ—¶é—´è¿‡æ»¤åŠŸèƒ½ã€‚

### Q3: æ•°æ®ä¸­çš„å•ä½æ˜¯ä»€ä¹ˆï¼Ÿ

**A**: 
- ä½ç½®: å¼§åº¦ï¼ˆradï¼‰ï¼Œ1 å¼§åº¦ â‰ˆ 57.3Â°
- é€Ÿåº¦: å¼§åº¦/ç§’ï¼ˆrad/sï¼‰
- åŠ›çŸ©: ç‰›é¡¿Â·ç±³ï¼ˆNmï¼‰
- æ—¶é—´: çº³ç§’ï¼ˆnsï¼‰ï¼Œ1 ç§’ = 10^9 çº³ç§’

### Q4: Lead å’Œ Follow æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**:
- **Leadï¼ˆä¸»æ§åˆ¶å™¨ï¼‰**: å‘é€çš„å‘½ä»¤ä½ç½®ï¼Œå‘Šè¯‰æœºå™¨äººåº”è¯¥å»å“ªé‡Œ
- **Followï¼ˆä»æ§åˆ¶å™¨ï¼‰**: åé¦ˆçš„å®é™…ä½ç½®ï¼Œæœºå™¨äººå®é™…åˆ°è¾¾çš„ä½ç½®

### Q5: å¦‚ä½•åˆ¤æ–­æœºå™¨äººè¿åŠ¨æ˜¯å¦æ­£å¸¸ï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. å…³èŠ‚ä½ç½®åœ¨åˆç†èŒƒå›´å†…
2. ä½ç½®å˜åŒ–è¿ç»­ï¼Œæ— çªè·³
3. Lead å’Œ Follow åŸºæœ¬ä¸€è‡´ï¼ˆè¯¯å·®<1Â°ï¼‰
4. é‡‡æ ·ç‡ç¨³å®šï¼ˆ~48 Hzï¼‰

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- **MCAP_åˆ†ææŠ¥å‘Š.md** - å®Œæ•´çš„æ•°æ®åˆ†ææŠ¥å‘Š
- **README.md** - å·¥å…·ä½¿ç”¨è¯´æ˜å’Œ API æ–‡æ¡£
- **parse_mcap.py** - æºä»£ç ï¼Œå¯ä»¥ä¿®æ”¹ä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚

---

**æ›´æ–°æ—¶é—´**: 2026-02-02  
**å·¥å…·ç‰ˆæœ¬**: v1.0  
**ç»´æŠ¤è€…**: QA Team
